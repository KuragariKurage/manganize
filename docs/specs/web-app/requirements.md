# Web アプリ 要件定義

## 概要

manganize のコアエージェント機能を Web アプリケーションとして提供する。
ユーザーがテキストコンテンツを入力またはアップロードし、マンガ画像を生成・閲覧できるようにする。

## 用語定義

| 用語 | 定義 |
|------|------|
| 生成リクエスト | ユーザーがテキストを入力し、マンガ画像生成を開始する操作 |
| 生成履歴 | 過去に生成されたマンガ画像とその入力テキストの記録 |
| 進捗状態 | 生成処理の現在の段階（研究中、シナリオ作成中、画像生成中、完了） |

---

## 機能要件

### FR-1: テキスト入力

#### FR-1.1: テキストエリアによる直接入力

**[Ubiquitous]**
システムは、ユーザーがテキストを直接入力できるテキストエリアを提供すること。

**[State-driven]**
テキストエリアが空の状態のとき、システムは生成ボタンを無効化すること。

#### FR-1.2: ファイルアップロード

**[Optional]**
ユーザーがファイルをアップロードすることを選択した場合、システムは `.txt` および `.md` 形式のファイルを受け付けること。

**[Event-driven]**
ユーザーがファイルをドラッグ＆ドロップした場合、システムはファイルの内容をテキストエリアに自動的に読み込むこと。

**[Event-driven]**
ユーザーが対応していない形式のファイルをアップロードした場合、システムはエラーメッセージを表示すること。

---

### FR-2: マンガ画像生成

#### FR-2.1: 生成リクエストの送信

**[Event-driven]**
ユーザーが生成ボタンをクリックした場合、システムはテキストをバックエンド API に送信し、マンガ画像生成処理を開始すること。

**[State-driven]**
生成処理が実行中の状態のとき、システムは生成ボタンを無効化すること。

#### FR-2.2: 進捗状態の表示

**[Ubiquitous]**
システムは、生成処理の進捗状態をリアルタイムでユーザーに表示すること。

**[State-driven]**
各進捗状態において、システムは以下の情報を表示すること：
- `researching`: 「リサーチ中...」
- `writing_scenario`: 「シナリオ作成中...」
- `generating_image`: 「画像生成中...」
- `completed`: 生成された画像

**[Event-driven]**
生成処理でエラーが発生した場合、システムはエラーメッセージを表示し、再試行オプションを提供すること。

#### FR-2.3: 生成結果の表示

**[Event-driven]**
生成処理が完了した場合、システムは生成されたマンガ画像を画面に表示すること。

**[Optional]**
ユーザーが画像をダウンロードすることを選択した場合、システムは PNG 形式で画像をダウンロードできるようにすること。

---

### FR-3: 生成履歴管理

#### FR-3.1: 履歴の保存

**[Event-driven]**
マンガ画像の生成が完了した場合、システムは入力テキスト、生成日時、生成画像を履歴として保存すること。

#### FR-3.2: 履歴の一覧表示

**[Ubiquitous]**
システムは、過去の生成履歴を一覧で表示する画面を提供すること。

**[Ubiquitous]**
履歴一覧には、生成日時とサムネイル画像を表示すること。

#### FR-3.3: 履歴の閲覧

**[Event-driven]**
ユーザーが履歴項目をクリックした場合、システムは該当する生成結果の詳細（入力テキスト、生成画像）を表示すること。

#### FR-3.4: 履歴の削除

**[Optional]**
ユーザーが履歴を削除することを選択した場合、システムは確認ダイアログを表示した後、該当する履歴を削除すること。

---

## 非機能要件

### NFR-1: パフォーマンス

**[Ubiquitous]**
システムは、生成処理の進捗更新を 1 秒以内にクライアントへ配信すること。

**[Ubiquitous]**
履歴一覧の表示は 2 秒以内に完了すること。

### NFR-2: ユーザビリティ

**[Ubiquitous]**
システムは、モバイルデバイスとデスクトップの両方で適切に表示されるレスポンシブデザインを採用すること。

**[Ubiquitous]**
主要な操作（テキスト入力、生成開始、履歴閲覧）は、最大 3 クリック以内で到達可能であること。

### NFR-3: 信頼性

**[Event-driven]**
バックエンドとの接続が切断された場合、システムは自動的に再接続を試みること。

**[Ubiquitous]**
生成処理中にブラウザを閉じた場合でも、バックエンド側で処理を完了し、履歴に保存すること。

### NFR-4: セキュリティ

**[Ubiquitous]**
アップロードされるファイルのサイズは 10MB 以下に制限すること。

**[Ubiquitous]**
システムは、アップロードされたファイルの内容を検証し、テキストファイル以外を拒否すること。

