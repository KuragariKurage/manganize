<!-- Result display for generated manga image -->
<div id="result-container" class="mb-6">
    <div class="card">
        {% if generation %}
            {% if status_value == 'completed' %}
                <!-- Success -->
                <h3 class="text-lg font-semibold mb-4 text-green-600">生成完了！</h3>

                {% if generation_type_value == 'revision' and generation.parent_generation_id %}
                <div class="mb-4 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800">
                    この画像はリビジョンです。
                    <a href="/api/images/{{ generation.parent_generation_id }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="ml-2 underline hover:text-blue-900">親画像を開く</a>
                </div>
                {% endif %}

                <!-- Generated title -->
                <h4 class="text-xl font-bold text-gray-800 mb-4">{{ generation.generated_title }}</h4>

                <!-- Generated image -->
                <div class="mb-4">
                    <img src="/api/images/{{ generation.id }}"
                         alt="{{ generation.generated_title }}"
                         class="w-full rounded-lg shadow-md cursor-pointer hover:shadow-xl transition"
                         onclick="openImageModal('{{ generation.id }}')"
                    />
                </div>

                <!-- Action buttons -->
                <div class="flex flex-wrap gap-3 justify-center mb-4">
                    <a href="/api/images/{{ generation.id }}/download"
                       class="btn-primary"
                       download>
                        ダウンロード
                    </a>
                    <a href="/generations/{{ generation.id }}/revision-workspace"
                       class="btn-secondary">
                        修正する
                    </a>
                    <button onclick="resetGeneration()"
                            class="btn-secondary"
                            type="button">
                        新しく生成
                    </button>
                </div>

            {% elif status_value == 'error' %}
                <!-- Error -->
                <h3 class="text-lg font-semibold mb-4 text-red-600">エラーが発生しました</h3>

                <div class="alert alert-error">
                    <p>{{ generation.error_message or '不明なエラーが発生しました' }}</p>
                </div>

                <!-- Retry button -->
                <div class="flex justify-center">
                    <button onclick="resetGeneration()"
                            class="btn-primary"
                            type="button">
                        再試行
                    </button>
                </div>
            {% else %}
                <!-- Still processing -->
                <p class="text-gray-600">生成処理中...</p>
            {% endif %}
        {% else %}
            <p class="text-gray-600">生成結果が見つかりません。</p>
        {% endif %}
    </div>
</div>

<script>
(function() {
    function resetGeneration() {
        const contentArea = document.getElementById('content-area');
        if (contentArea) {
            contentArea.innerHTML = '';
        }

        window.dispatchEvent(new CustomEvent('reset-generation'));
    }

    window.resetGeneration = resetGeneration;
})();
</script>
