# Feature Specification: Manganize Web App

**Feature Branch**: `001-web-app`
**Created**: 2025-12-27
**Status**: Draft
**Input**: User description: "manganize Web アプリ - キャラクターカスタマイズ、トピック入力、画像表示・ダウンロード"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - マンガ画像の生成 (Priority: P1)

ユーザーとして、トピックを入力してマンガ画像を生成したい。これにより、テキストコンテンツを視覚的なマンガ形式で楽しむことができる。

**Why this priority**: これはアプリケーションのコア機能であり、他のすべての機能の基盤となる。この機能なしではアプリの価値が成立しない。

**Independent Test**: トピックを入力して「生成」ボタンをクリックし、進捗表示を経てマンガ画像が表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** メインページにいる状態、**When** トピック「Transformerアーキテクチャについて」を入力して生成ボタンをクリック、**Then** 進捗状態（リサーチ中→シナリオ作成中→画像生成中）が順次表示され、最終的にマンガ画像が表示される
2. **Given** トピック入力エリアが空の状態、**When** 生成ボタンを確認、**Then** ボタンは無効化されている
3. **Given** 生成処理中の状態、**When** 生成ボタンを確認、**Then** ボタンは無効化されている
4. **Given** 生成処理中の状態、**When** エラーが発生、**Then** エラーメッセージと再試行オプションが表示される

---

### User Story 2 - 画像表示・ダウンロード (Priority: P2)

ユーザーとして、生成されたマンガ画像を閲覧し、ダウンロードしたい。これにより、生成結果を保存して後で楽しんだり、共有したりできる。

**Why this priority**: 生成機能の直接的な延長であり、ユーザーが生成物を活用するために必須の機能。

**Independent Test**: 生成完了後の画像を表示し、ダウンロードボタンでローカルに保存できることを確認する。

**Acceptance Scenarios**:

1. **Given** マンガ画像が生成された状態、**When** 画像をクリック、**Then** フルサイズの画像がモーダルで表示される
2. **Given** 生成結果が表示されている状態、**When** ダウンロードボタンをクリック、**Then** PNG形式の画像ファイルがダウンロードされる
3. **Given** ダウンロードを実行、**When** ファイル名を確認、**Then** `manganize_日時_トピック.png` 形式になっている

---

### User Story 3 - キャラクターカスタマイズ (Priority: P3)

ユーザーとして、マンガに登場するキャラクターをカスタマイズしたい。これにより、オリジナルのキャラクターで漫画を生成できる。

**Why this priority**: コア機能とは独立した拡張機能であり、基本機能が安定した後に追加すべき。

**Independent Test**: キャラクターページで新規キャラクターを作成し、メインページでそのキャラクターを選択して生成できることを確認する。

**Acceptance Scenarios**:

1. **Given** メインページにいる状態、**When** キャラクター選択ドロップダウンを確認、**Then** デフォルトキャラクター「くらげ」が選択可能である
2. **Given** キャラクターページにいる状態、**When** 新規キャラクターの情報（名前、説明、外見、性格）を入力して保存、**Then** キャラクター一覧に追加される
3. **Given** カスタムキャラクターが登録されている状態、**When** メインページでそのキャラクターを選択して生成、**Then** 選択したキャラクターでマンガが生成される
4. **Given** キャラクター編集画面にいる状態、**When** デフォルトキャラクターを選択、**Then** 削除ボタンは無効化されている

---

### User Story 4 - 生成履歴の管理 (Priority: P4)

ユーザーとして、過去の生成履歴を閲覧・管理したい。これにより、以前の生成結果を再確認したり、比較したりできる。

**Why this priority**: 利便性向上のための機能であり、他のコア機能の後に実装すべき。

**Independent Test**: 履歴ページで過去の生成結果一覧を確認し、項目をクリックして詳細を閲覧できることを確認する。

**Acceptance Scenarios**:

1. **Given** 複数のマンガを生成した後、**When** 履歴ページにアクセス、**Then** 生成日時の降順でサムネイルとトピックの一覧が表示される
2. **Given** 履歴一覧を閲覧中、**When** 項目をクリック、**Then** 該当する生成結果の詳細（トピック、キャラクター、画像）が表示される
3. **Given** 履歴が20件以上ある状態、**When** ページ下部までスクロール、**Then** 次のページの履歴が自動的に読み込まれる
4. **Given** 履歴詳細を閲覧中、**When** 削除ボタンをクリックして確認、**Then** 該当する履歴が削除される

---

### Edge Cases

- 入力トピックが空文字または空白のみの場合、生成ボタンは無効のまま
- 生成中にネットワーク接続が切断された場合、自動的に再接続を試みる
- 生成中にブラウザを閉じた場合、バックエンド側で処理を完了し履歴に保存する
- 10MBを超えるファイルをアップロードしようとした場合、エラーメッセージを表示
- 対応していないファイル形式（.txt, .md, .pdf以外）をアップロードした場合、エラーメッセージを表示
- キャラクター名に不正な文字（特殊記号等）を入力した場合、バリデーションエラーを表示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、ユーザーがトピックを直接入力できるテキストエリアを提供すること
- **FR-002**: テキストエリアが空の状態のとき、システムは生成ボタンを無効化すること
- **FR-003**: ユーザーが生成ボタンをクリックした場合、システムはトピックをバックエンドに送信し、マンガ画像生成処理を開始すること
- **FR-004**: システムは、生成処理中にリアルタイムで進捗状態（リサーチ中、シナリオ作成中、画像生成中、完了）を表示すること
- **FR-005**: 生成処理が完了した場合、システムは生成されたマンガ画像を表示すること
- **FR-006**: システムは、トピックから 3-5 単語の短いタイトルを自動生成すること
- **FR-007**: ユーザーがダウンロードを選択した場合、システムは `manganize_{日時}_{短いタイトル}.png` 形式のファイル名で PNG 画像を提供すること
- **FR-008**: システムは、生成に使用するキャラクターを選択するドロップダウンを提供すること
- **FR-009**: システムは、デフォルトキャラクター「くらげ」を提供すること
- **FR-010**: ユーザーが新規キャラクターを作成することを選択した場合、システムは名前、説明、外見、性格、および任意の参照画像の入力を許可すること
- **FR-011**: システムは、トピック、生成されたタイトル、キャラクター、画像、タイムスタンプを含む生成履歴を保存すること
- **FR-012**: システムは、サムネイルと生成されたタイトルを含む生成履歴を新しい順に表示すること
- **FR-013**: ユーザーが履歴を削除することを選択した場合、システムは削除前に確認ダイアログを表示すること
- **FR-014**: システムは、履歴一覧に無限スクロールを実装すること
- **FR-015**: ユーザーがファイルをアップロードする場合、システムは `.txt` や `.pdf` および `.md` 形式のみ、10MB 以下を受け付けること
- **FR-016**: ユーザーが有効なファイルをドラッグ＆ドロップした場合、システムはファイルの内容をテキストエリアに読み込むこと
- **FR-017**: 生成処理でエラーが発生した場合、システムはエラーメッセージと再試行オプションを表示すること

### 主要エンティティ

- **Generation（生成）**: トピック、生成されたタイトル（3-5単語の要約）、キャラクター、画像、ステータスを含むマンガ生成リクエストを表す
- **Character（キャラクター）**: 名前、説明、外見の特徴、性格・口調、および任意の参照画像を持つマンガキャラクターを表す
- **History（履歴）**: トピック、生成されたタイトル、キャラクター、画像、タイムスタンプを含む、後で取得可能な保存された生成結果を表す

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは、トピック入力から画像表示までのマンガ生成を 5 分以内に完了できること（AI 処理時間を除く）
- **SC-002**: 進捗更新は、ステータス変更から 1 秒以内にユーザーに表示されること
- **SC-003**: ページの初期読み込みは 2 秒以内に完了すること
- **SC-004**: 90% のユーザーがガイダンスなしで最初のマンガ生成に成功すること
- **SC-005**: スクロール時に履歴一覧の追加項目が 1 秒以内に読み込まれること
- **SC-006**: ユーザーは、カスタムキャラクターを 3 分以内に作成できること
- **SC-007**: システムは、モバイルデバイスとデスクトップブラウザの両方でレスポンシブに動作すること
- **SC-008**: 主要なアクション（トピック入力、生成、履歴閲覧）は、どのページからも 3 クリック以内で到達可能であること

## Assumptions

以下は明示的に指定されていなかったため、合理的なデフォルトとして想定：

- **認証**: 初期バージョンでは認証なし（ローカル使用を想定）
- **データ保存**: SQLite を使用（開発環境向け、本番ではPostgreSQLに移行可能）
- **キャラクター参照画像**: 画像は任意（必須ではない）、対応形式は PNG/JPEG
- **履歴保持期間**: 無期限（ユーザーが明示的に削除するまで保持）
- **同時生成**: 1ユーザーあたり1つの生成プロセスのみ（複数同時生成は初期スコープ外）
- **ファイルアップロード**: ドラッグ＆ドロップおよびファイル選択ダイアログの両方をサポート
- **言語**: 日本語UIを基本とする（多言語対応は初期スコープ外）
- **タイトル生成**: LLMを使用してトピックから3-5単語の短いタイトルを生成。特殊文字は `_` に置換し、ファイル名として安全な形式にする。生成に失敗した場合は日時のみをファイル名として使用
